dummy:V:	montar_fs
	echo "nothing to do"

# Hosts
visnu:V:	compartir_fs
notron:V:	compartir_fs

# clases
compartir_fs:V:	/var/lib/cluster/compartido
montar_fs:V:	/var/lib/cluster/montar_fs

/var/lib/cluster/compartido:	/etc/exports
	etckeeper commit -m 'Generar configuraciÃ³n para compartir sistemas de archivos' || true
	etckeeper vcs push
	mkdir -p `dirname $target`
	touch /var/lib/cluster/compartido

/etc/exports:	/etc/cluster/nfs_exports
	apt-get -y install nfs-kernel-server
	grep -E '^'`hostname`':' $prereq \
	| sed -e 's#^'`hostname`':##' \
	> $target

/var/lib/cluster/montar_fs:	/etc/cluster/nfs_mounts
	apt-get -y install nfs-common
	cat $prereq \
	| xargs -l -I{} \
		sh -c 'grep "{}" /etc/fstab || echo "{}" >> /etc/fstab'
	mount -a
	awk '{print $2}' $prereq | xargs mkdir -p
	etckeeper commit -m 'Sistemas de archivos compartidos.' || true
	etckeeper vcs push
	mkdir -p `dirname $target`
	touch $target
